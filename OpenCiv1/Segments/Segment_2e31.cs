using System;
using IRB.VirtualCPU;

namespace OpenCiv1
{
    public class Segment_2e31
    {
        private OpenCiv1 oParent;
        private CPU oCPU;

        public Segment_2e31(OpenCiv1 parent)
        {
            this.oParent = parent;
            this.oCPU = parent.CPU;
        }

        /// <summary>
        /// ?
        /// </summary>
        /// <param name="playerID"></param>
        /// <param name="unitID"></param>
        /// <returns></returns>
        public ushort F0_2e31_000e(short playerID, short unitID)
        {
            this.oCPU.Log.EnterBlock($"F0_2e31_000e({playerID}, {unitID})");

            // function body
            this.oCPU.PushWord(this.oCPU.BP.Word);
            this.oCPU.BP.Word = this.oCPU.SP.Word;
            this.oCPU.SP.Word = this.oCPU.SUBWord(this.oCPU.SP.Word, 0x2a);
            this.oCPU.PushWord(this.oCPU.DI.Word);
            this.oCPU.PushWord(this.oCPU.SI.Word);

            if (playerID != this.oParent.GameState.HumanPlayerID)
                goto L00f9;

            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);

            if (unitID < 128)
            {
                this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
                this.oCPU.AX.High = 0;
                this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5));
                this.oCPU.CX.High = 0;
                this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.CX.Word);
            }
            else
            {
                this.oCPU.AX.Word = 0;
            }
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e), this.oCPU.AX.Word);

            if (unitID < 128)
            {
                this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
                this.oCPU.AX.High = 0;
                this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d6));
                this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.CX.Word);
            }
            else
            {
                this.oCPU.AX.Word = 0;
            }
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x0054, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x1);
            if (this.oCPU.Flags.LE) goto L0064;
            goto L00f9;

        L0064:
            // Instruction address 0x2e31:0x0067, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x1);
            if (this.oCPU.Flags.LE) goto L0077;
            goto L00f9;

        L0077:
            // Instruction address 0x2e31:0x007a, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x28);
            if (this.oCPU.Flags.GE) goto L0094;
            this.oCPU.AX.Word = (ushort)Math.Sign((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));
            goto L00a1;

        L0094:
            this.oCPU.AX.Word = (ushort)Math.Sign((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));
            this.oCPU.AX.Word = this.oCPU.NEGWord(this.oCPU.AX.Word);

        L00a1:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e), this.oCPU.AX.Word);
            this.oCPU.AX.Word = (ushort)Math.Sign((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20), this.oCPU.AX.Word);

            if (unitID < 128)
            {
                this.oCPU.AX.Word = 0xc;
                this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
                this.oCPU.BX.Word = this.oCPU.AX.Word;

                this.oCPU.AX.Word = 0x600;
                this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
                this.oCPU.SI.Word = this.oCPU.AX.Word;

                this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81da), 0xff);
            }

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18), 0x1);
            goto L00d1;

        L00ce:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18))));

        L00d1:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18)), 0x8);
            if (this.oCPU.Flags.G) goto L00f4;
            this.oCPU.SI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18));
            this.oCPU.SI.Word = this.oCPU.SHLWord(this.oCPU.SI.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1882)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L00ce;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x18e4)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L00ce;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18));
            goto L05e0;

        L00f4:
            this.oCPU.AX.Word = 0;
            goto L05e0;

        L00f9:
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)), 0x1);
            if (this.oCPU.Flags.NE) goto L012b;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);
            goto L0208;

        L012b:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), 0x0);
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.AX.High = 0;
            this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5));
            this.oCPU.CX.High = 0;
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.CX.Word);

            // Instruction address 0x2e31:0x014f, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x7);
            if (this.oCPU.Flags.L) goto L0178;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.AX.High = 0;
            this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5));
            this.oCPU.CX.High = 0;
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.CX.Word);

            // Instruction address 0x2e31:0x016b, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x49);
            if (this.oCPU.Flags.LE) goto L01d8;

            L0178:
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
            this.oCPU.AX.High = 0;
            this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d6));
            this.oCPU.CX.High = 0;
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.CX.Word);

            // Instruction address 0x2e31:0x0197, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x7);
            if (this.oCPU.Flags.GE) goto L01d8;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x01bf, size: 3
            F0_2e31_0c1d(playerID, unitID, 0x3e7);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xffff);
            if (this.oCPU.Flags.E) goto L01d3;

            L01cd:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14));
            goto L05e0;

        L01d3:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), 0x1);

        L01d8:
            // Instruction address 0x2e31:0x01df, size: 3
            F0_2e31_05e6(playerID, unitID);

            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L01ef;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe)), 0x0);
            if (this.oCPU.Flags.NE) goto L0208;

            L01ef:
            // Instruction address 0x2e31:0x01fa, size: 3
            F0_2e31_0c1d(playerID, unitID, 0x3e7);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xffff);
            if (this.oCPU.Flags.NE) goto L01cd;

            L0208:
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590);
            this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5));
            this.oCPU.CX.High = 0;
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.CX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592);
            this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d6));
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.CX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x0233, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.DI.Word = this.oCPU.AX.Word;
            // Instruction address 0x2e31:0x0240, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x26), this.oCPU.AX.Word);
            // Instruction address 0x2e31:0x024e, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x28), this.oCPU.AX.Word);
            // Instruction address 0x2e31:0x025c, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x28)));
            if (this.oCPU.Flags.LE) goto L026e;

            // Instruction address 0x2e31:0x0271, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));
            goto L0271;

        L026e:
            // Instruction address 0x2e31:0x0271, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));

        L0271:
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x26)));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.DI.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)), 0x0);
            if (this.oCPU.Flags.NE) goto L02a2;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)), 0x0);
            if (this.oCPU.Flags.NE) goto L02a2;
            this.oCPU.AX.Low = 0xff;
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81dc), this.oCPU.AX.Low);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da), this.oCPU.AX.Low);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d8), 0x0);
            this.oCPU.AX.Word = 0xffff;
            goto L05e0;

        L02a2:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x24), 0x270f);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), 0x0);
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x02c8, size: 5
            this.oParent.Segment_2aea.F0_2aea_1585(
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5)),
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d6)));

            this.oCPU.AX.Word = this.oCPU.ANDWord(this.oCPU.AX.Word, 0x8);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x02e5, size: 5
            this.oParent.Segment_1866.F0_1866_1725(playerID,
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5)),
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d6)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1c), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18), 0x1);
            goto L0324;

        L02f7:
            // Instruction address 0x2e31:0x02fa, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4)));

        L02fa:
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x26)));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x28)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16), this.oCPU.AX.Word);

            if (playerID != this.oParent.GameState.HumanPlayerID)
                goto L03b1;

            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.G) goto L0321;
            goto L03b1;

        L0321:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18))));

        L0324:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18)), 0x9);
            if (this.oCPU.Flags.L) goto L032d;
            goto L0571;

        L032d:
            this.oCPU.SI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18));
            this.oCPU.SI.Word = this.oCPU.SHLWord(this.oCPU.SI.Word, 0x1);
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.DI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.DI.Word = this.oCPU.ADDWord(this.oCPU.DI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.DI.Word + 0x81d5));
            this.oCPU.AX.High = 0;
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1882)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10), this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.DI.Word + 0x81d6));
            this.oCPU.AX.High = 0;
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x18e4)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e));
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1882)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20));
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x18e4)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x0371, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x28), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x037f, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x26), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x038d, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2a), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x039b, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2a)));
            if (this.oCPU.Flags.G) goto L03ab;
            goto L02f7;

        L03ab:
            // Instruction address 0x2e31:0x02fa, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)));
            goto L02fa;

        L03b1:
            // Instruction address 0x2e31:0x03b7, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x03c8, size: 5
            this.oParent.Segment_2aea.F0_2aea_14e0(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x22), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xffff);
            if (this.oCPU.Flags.E) goto L03e0;
            this.oCPU.AX.Word = (ushort)playerID;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x22)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L0455;

            L03e0:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a)), 0xa);
            if (this.oCPU.Flags.NE) goto L03eb;
            this.oCPU.AX.Word = 0x1;
            goto L03ed;

        L03eb:
            this.oCPU.AX.Word = 0;

        L03ed:
            this.oCPU.CX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.SI.Word = this.oCPU.CX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)), 0x2);
            if (this.oCPU.Flags.NE) goto L0415;
            this.oCPU.AX.Word = 0x1;
            goto L0417;

        L0415:
            this.oCPU.AX.Word = 0;

        L0417:
            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.SI.Word);
            if (this.oCPU.Flags.NE) goto L0436;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1c)), 0x0);
            if (this.oCPU.Flags.E) goto L0480;

            // Instruction address 0x2e31:0x042a, size: 5
            this.oParent.Segment_1866.F0_1866_1725(playerID,
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));

            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0480;

            L0436:
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)), 0x1);
            if (this.oCPU.Flags.E) goto L0480;

            L0455:
            // Instruction address 0x2e31:0x045b, size: 5
            this.oParent.Segment_2aea.F0_2aea_1585(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));

            this.oCPU.TESTByte(this.oCPU.AX.Low, 0x1);
            if (this.oCPU.Flags.NE) goto L046a;
            goto L0321;

        L046a:
            // Instruction address 0x2e31:0x0470, size: 5
            this.oParent.Segment_2aea.F0_2aea_1369(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, (ushort)playerID);
            if (this.oCPU.Flags.E) goto L0480;
            goto L0321;

        L0480:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a)), 0xa);
            if (this.oCPU.Flags.NE) goto L049c;

            // Instruction address 0x2e31:0x048c, size: 5
            this.oParent.Segment_2aea.F0_2aea_195d(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x5);
            if (this.oCPU.Flags.GE) goto L049c;
            goto L0321;

        L049c:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)), 0x0);
            if (this.oCPU.Flags.E) goto L04b4;

            // Instruction address 0x2e31:0x04a8, size: 5
            this.oParent.Segment_2aea.F0_2aea_1585(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));

            this.oCPU.TESTByte(this.oCPU.AX.Low, 0x8);
            if (this.oCPU.Flags.NE) goto L04eb;

            L04b4:
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x113a)), 0x1);
            if (this.oCPU.Flags.LE) goto L04e3;
            this.oCPU.AX.Word = 0x13;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x3;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x28e)));
            goto L04e6;

        L04e3:
            this.oCPU.AX.Word = 0x3;

        L04e6:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), this.oCPU.AX.Word);
            goto L04f0;

        L04eb:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), 0x1);

        L04f0:
            // Instruction address 0x2e31:0x04f3, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4)));

            this.oCPU.SI.Word = this.oCPU.AX.Word;

            // Instruction address 0x2e31:0x0500, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)));

            this.oCPU.CX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16));
            this.oCPU.CX.Word = this.oCPU.SHLWord(this.oCPU.CX.Word, 0x1);
            this.oCPU.CX.Word = this.oCPU.SHLWord(this.oCPU.CX.Word, 0x1);
            this.oCPU.CX.Word = this.oCPU.ADDWord(this.oCPU.CX.Word, this.oCPU.AX.Word);
            this.oCPU.CX.Word = this.oCPU.ADDWord(this.oCPU.CX.Word, this.oCPU.SI.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), this.oCPU.ADDWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)), this.oCPU.CX.Word));
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81dc));
            this.oCPU.WriteUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2a), this.oCPU.AX.Low);
            this.oCPU.CMPByte(this.oCPU.AX.Low, 0xff);
            if (this.oCPU.Flags.E) goto L0557;
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18)));

            // Instruction address 0x2e31:0x0536, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x4);
            if (this.oCPU.Flags.LE) goto L054f;
            this.oCPU.AX.Word = 0x8;
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6), this.oCPU.AX.Word);

        L054f:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6));
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), this.oCPU.ADDWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)), this.oCPU.AX.Word));

        L0557:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x24));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.L) goto L0562;
            goto L0321;

        L0562:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x18));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x24), this.oCPU.AX.Word);
            goto L0321;

        L0571:
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.CMPByte(this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81dc)), 0xff);
            if (this.oCPU.Flags.E) goto L059e;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81dc));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.AX.Low = this.oCPU.XORByte(this.oCPU.AX.Low, 0x4);
            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)));
            if (this.oCPU.Flags.NE) goto L059e;
            this.oCPU.AX.Low = 0;
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d8), this.oCPU.AX.Low);
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), this.oCPU.AX.Word);

        L059e:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)), 0x0);
            if (this.oCPU.Flags.NE) goto L05c6;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = 0xff;
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81dc), this.oCPU.AX.Low);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da), this.oCPU.AX.Low);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), 0xffff);
            goto L01cd;

        L05c6:
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14));
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81dc), this.oCPU.AX.Low);
            goto L01cd;

        L05e0:
            this.oCPU.SI.Word = this.oCPU.PopWord();
            this.oCPU.DI.Word = this.oCPU.PopWord();
            this.oCPU.SP.Word = this.oCPU.BP.Word;
            this.oCPU.BP.Word = this.oCPU.PopWord();
            // Far return
            this.oCPU.Log.ExitBlock("F0_2e31_000e");

            return this.oCPU.AX.Word;
        }

        /// <summary>
        /// ?
        /// </summary>
        /// <param name="playerID"></param>
        /// <param name="unitID"></param>
        /// <returns></returns>
        public ushort F0_2e31_05e6(short playerID, short unitID)
        {
            this.oCPU.Log.EnterBlock($"F0_2e31_05e6({playerID}, {unitID})");

            // function body
            this.oCPU.PushWord(this.oCPU.BP.Word);
            this.oCPU.BP.Word = this.oCPU.SP.Word;
            this.oCPU.SP.Word = this.oCPU.SUBWord(this.oCPU.SP.Word, 0x3a);
            this.oCPU.PushWord(this.oCPU.DI.Word);
            this.oCPU.PushWord(this.oCPU.SI.Word);
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36), this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d6));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a), this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;

            // Instruction address 0x2e31:0x063a, size: 3
            F0_2e31_0a2c(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)),
                (ushort)((this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)) != 2) ? 0 : 1));

            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0674;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a), this.oCPU.AX.Word);
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;

            goto L0699;

        L0674:
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);
            goto L0a26;

        L0699:
            // Instruction address 0x2e31:0x06a7, size: 3
            F0_2e31_0a2c(
                this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da)),
                this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db)),
                (ushort)((this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)) != 0x2) ? 0 : 1));

            // Instruction address 0x2e31:0x06b8, size: 5
            this.oParent.MSCAPI.memset(0xd816, 0, 0x104);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), 0x0);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), 0x0);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, 0x6590);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, 0x6594, this.oCPU.AX.Low);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2))));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, 0x6592);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6694), this.oCPU.AX.Low);
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590));
            this.oCPU.DI.Word = this.oCPU.AX.Word;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.DI.Word + 0xd816), 0x1);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc), 0x0);
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)), 0x2);
            if (this.oCPU.Flags.NE) goto L0708;
            this.oCPU.AX.Word = 0x1;
            goto L070a;

        L0708:
            this.oCPU.AX.Word = 0;

        L070a:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16), this.oCPU.AX.Word);

        L070d:
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6594));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6694));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2c), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L0738;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2c)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L0738;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc), 0x1);
            goto L0815;

        L0738:
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2c));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0xd816));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4))));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16)), 0x0);
            if (this.oCPU.Flags.E) goto L076a;
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x7f38));
            goto L0776;

        L076a:
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0xdb44));

        L0776:
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e), 0x1);

        L077f:
            this.oCPU.AX.Word = 0x1;
            this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e));
            this.oCPU.CX.Low = this.oCPU.DECByte(this.oCPU.CX.Low);
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, this.oCPU.CX.Low);
            this.oCPU.TESTWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)));
            if (this.oCPU.Flags.E) goto L07f8;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e));
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1882));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x14);
            if (this.oCPU.Flags.NE) goto L07a7;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30), 0x0);

        L07a7:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30)), 0xffff);
            if (this.oCPU.Flags.NE) goto L07b2;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30), 0x13);

        L07b2:
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e));
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x18e4));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2c)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x34), this.oCPU.AX.Word);
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x34)));
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, 0xd816);
            this.oCPU.CMPByte(this.oCPU.ReadUInt8(this.oCPU.DS.Word, this.oCPU.SI.Word), 0x0);
            if (this.oCPU.Flags.NE) goto L07f8;
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa));
            this.oCPU.AX.Low = this.oCPU.INCByte(this.oCPU.AX.Low);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, this.oCPU.SI.Word, this.oCPU.AX.Low);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30));
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6594), this.oCPU.AX.Low);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x34));
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6694), this.oCPU.AX.Low);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2))));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.AX.Word);

        L07f8:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e))));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e)), 0x8);
            if (this.oCPU.Flags.G) goto L0804;
            goto L077f;

        L0804:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)), 0x0);
            if (this.oCPU.Flags.NE) goto L0815;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0815;
            goto L070d;

        L0815:
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, 0xffff);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)), 0x0);
            if (this.oCPU.Flags.NE) goto L0824;
            goto L09fc;

        L0824:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), 0x63);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), 0xffff);
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)), 0x2);
            if (this.oCPU.Flags.NE) goto L085e;
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x7f38));
            goto L086d;

        L085e:
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0xdb44));

        L086d:
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e), 0x1);
            goto L08d2;

        L0878:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L08cf;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x08b0, size: 5
            this.oParent.Segment_2dc4.F0_2dc4_0289(
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30)) * 4 + 1,
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x34)) * 4 + 1);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.GE) goto L08cf;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12));

        L08cc:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa), this.oCPU.AX.Word);

        L08cf:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e))));

        L08d2:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e)), 0x8);
            if (this.oCPU.Flags.LE) goto L08db;
            goto L0981;

        L08db:
            this.oCPU.AX.Word = 0x1;
            this.oCPU.CX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e));
            this.oCPU.CX.Low = this.oCPU.DECByte(this.oCPU.CX.Low);
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, this.oCPU.CX.Low);
            this.oCPU.TESTWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)));
            if (this.oCPU.Flags.E) goto L08cf;
            this.oCPU.SI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e));
            this.oCPU.SI.Word = this.oCPU.SHLWord(this.oCPU.SI.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1882));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x18e4));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x34), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30)), 0x14);
            if (this.oCPU.Flags.NE) goto L090e;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30), 0x0);

        L090e:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30)), 0xffff);
            if (this.oCPU.Flags.NE) goto L0919;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30), 0x13);

        L0919:
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30)));
            this.oCPU.DI.Word = this.oCPU.AX.Word;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x34));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.DI.Word + 0xd816));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L08cf;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.L) goto L093b;
            goto L0878;

        L093b:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2e));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), this.oCPU.AX.Word);

            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x0976, size: 5
            this.oParent.Segment_2dc4.F0_2dc4_0289(
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x30)) * 4 + 1,
                this.oCPU.ReadInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x34)) * 4 + 1);

            goto L08cc;

        L0981:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe)), 0xffff);
            if (this.oCPU.Flags.E) goto L09fc;
            this.oCPU.SI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe));
            this.oCPU.SI.Word = this.oCPU.SHLWord(this.oCPU.SI.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1882));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)));
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.INCWord(this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x099d, size: 3
            F0_2e31_119b_AdjustXPosition(this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6590));

            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x18e4));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.INCWord(this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x09ba, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6590),
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6592));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.NE) goto L09cc;
            this.oCPU.AX.Word = 0x1;
            goto L09ce;

        L09cc:
            this.oCPU.AX.Word = 0;

        L09ce:
            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16)));
            if (this.oCPU.Flags.E) goto L09fc;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590)));

            // Instruction address 0x2e31:0x09df, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6590),
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6592));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.NE) goto L09f1;
            this.oCPU.AX.Word = 0x1;
            goto L09f3;

        L09f1:
            this.oCPU.AX.Word = 0;

        L09f3:
            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16)));
            if (this.oCPU.Flags.E) goto L09fc;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592)));

        L09fc:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590), 0xffff);
            if (this.oCPU.Flags.NE) goto L0a23;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)playerID);
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)unitID);
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);

        L0a23:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc));

        L0a26:
            this.oCPU.SI.Word = this.oCPU.PopWord();
            this.oCPU.DI.Word = this.oCPU.PopWord();
            this.oCPU.SP.Word = this.oCPU.BP.Word;
            this.oCPU.BP.Word = this.oCPU.PopWord();
            // Far return
            this.oCPU.Log.ExitBlock("F0_2e31_05e6");

            return this.oCPU.AX.Word;
        }

        /// <summary>
        /// ?
        /// </summary>
        /// <param name="xPos"></param>
        /// <param name="yPos"></param>
        /// <param name="flag"></param>
        /// <returns></returns>
        public ushort F0_2e31_0a2c(int xPos, int yPos, ushort flag)
        {
            this.oCPU.Log.EnterBlock($"F0_2e31_0a2c({xPos}, {yPos}, {flag})");

            // function body
            this.oCPU.PushWord(this.oCPU.BP.Word);
            this.oCPU.BP.Word = this.oCPU.SP.Word;
            this.oCPU.SP.Word = this.oCPU.SUBWord(this.oCPU.SP.Word, 0x14);
            this.oCPU.PushWord(this.oCPU.DI.Word);
            this.oCPU.PushWord(this.oCPU.SI.Word);
            this.oCPU.AX.Word = (ushort)((short)xPos);
            this.oCPU.CWD(this.oCPU.AX, this.oCPU.DX);
            this.oCPU.AX.Word = this.oCPU.XORWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.CX.Word = 0x2;
            this.oCPU.AX.Word = this.oCPU.SARWord(this.oCPU.AX.Word, this.oCPU.CX.Low);
            this.oCPU.AX.Word = this.oCPU.XORWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12), this.oCPU.AX.Word);
            this.oCPU.AX.Word = (ushort)((short)yPos);
            this.oCPU.CWD(this.oCPU.AX, this.oCPU.DX);
            this.oCPU.AX.Word = this.oCPU.XORWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.AX.Word = this.oCPU.SARWord(this.oCPU.AX.Word, this.oCPU.CX.Low);
            this.oCPU.AX.Word = this.oCPU.XORWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.DX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), 0xffff);

            if (flag != 0)
            {
                this.oCPU.AX.Word = 0xd;
                this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));
                this.oCPU.SI.Word = this.oCPU.AX.Word;
                this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14));

                if (this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x7f38)) != 0)
                {
                    this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), 0x0);
                }
            }
            else
            {
                this.oCPU.AX.Word = 0xd;
                this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));
                this.oCPU.SI.Word = this.oCPU.AX.Word;
                this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14));

                if (this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0xdb44)) != 0x0)
                {
                    this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), 0x0);
                }
            }

            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe)), 0xffff);
            if (this.oCPU.Flags.E) goto L0a96;
            goto L0bf1;

        L0a96:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6), 0x63);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10), 0x1);
            goto L0ad8;

        L0aa2:
            this.oCPU.AX.Word = 0;

        L0aa4:
            if (this.oCPU.AX.Word != flag)
                goto L0b7f;

            L0aac:
            // Instruction address 0x2e31:0x0ac0, size: 3
            F0_2e31_111c(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)),
                xPos, yPos, flag, 18);

            this.oCPU.AX.Word = this.oCPU.INCWord(this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0ad5;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), this.oCPU.AX.Word);

        L0ad5:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10))));

        L0ad8:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)), 0x8);
            if (this.oCPU.Flags.LE) goto L0ae1;
            goto L0bf1;

        L0ae1:
            this.oCPU.SI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10));
            this.oCPU.SI.Word = this.oCPU.SHLWord(this.oCPU.SI.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1882));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x18e4));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc), this.oCPU.AX.Word);

            if (flag == 0) goto L0b12;
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa)));
            this.oCPU.DI.Word = this.oCPU.AX.Word;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc));
            this.oCPU.CMPByte(this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.DI.Word + 0x7f38)), 0x0);
            if (this.oCPU.Flags.NE) goto L0b2a;

            L0b12:
            if (flag != 0) goto L0ad5;
            this.oCPU.AX.Word = 0xd;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc));
            this.oCPU.CMPByte(this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0xdb44)), 0x0);
            if (this.oCPU.Flags.E) goto L0ad5;

            L0b2a:
            this.oCPU.SI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa));
            this.oCPU.SI.Word <<= 2;

            this.oCPU.DI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc));
            this.oCPU.DI.Word <<= 2;

            // Instruction address 0x2e31:0x0b43, size: 5
            this.oParent.Segment_2dc4.F0_2dc4_0208_CombinePosition(
                xPos - (this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa)) * 4) - 1,
                yPos - (this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)) * 4) - 1);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), this.oCPU.AX.Word);

            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.L) goto L0b59;
            goto L0ad5;

        L0b59:
            // LEA
            this.oCPU.AX.Word = (ushort)(this.oCPU.SI.Word + 0x1);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.AX.Word);
            // LEA
            this.oCPU.AX.Word = (ushort)(this.oCPU.DI.Word + 0x1);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x0b69, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.E) goto L0b79;
            goto L0aa2;

        L0b79:
            this.oCPU.AX.Word = 0x1;
            goto L0aa4;

        L0b7f:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2),
                this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2))));

            // Instruction address 0x2e31:0x0b88, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.NE) goto L0b9a;
            this.oCPU.AX.Word = 0x1;
            goto L0b9c;

        L0b9a:
            this.oCPU.AX.Word = 0;

        L0b9c:
            if (this.oCPU.AX.Word == flag)
                goto L0aac;

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8),
                this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8))));

            // Instruction address 0x2e31:0x0bad, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.NE) goto L0bbf;
            this.oCPU.AX.Word = 0x1;
            goto L0bc1;

        L0bbf:
            this.oCPU.AX.Word = 0;

        L0bc1:
            if (this.oCPU.AX.Word == flag)
                goto L0aac;

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2),
                this.oCPU.DECWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2))));

            // Instruction address 0x2e31:0x0bd2, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.NE) goto L0be4;
            this.oCPU.AX.Word = 0x1;
            goto L0be6;

        L0be4:
            this.oCPU.AX.Word = 0;

        L0be6:
            if (this.oCPU.AX.Word == flag) goto L0aac;
            goto L0ad5;

        L0bf1:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe)), 0xffff);
            if (this.oCPU.Flags.E) goto L0c15;
            this.oCPU.SI.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe));
            this.oCPU.SI.Word = this.oCPU.SHLWord(this.oCPU.SI.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1882));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x18e4));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14)));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);
            this.oCPU.AX.Word = 0x1;
            goto L0c17;

        L0c15:
            this.oCPU.AX.Word = 0;

        L0c17:
            this.oCPU.SI.Word = this.oCPU.PopWord();
            this.oCPU.DI.Word = this.oCPU.PopWord();
            this.oCPU.SP.Word = this.oCPU.BP.Word;
            this.oCPU.BP.Word = this.oCPU.PopWord();
            // Far return
            this.oCPU.Log.ExitBlock("F0_2e31_0a2c");

            return this.oCPU.AX.Word;
        }

        /// <summary>
        /// ?
        /// </summary>
        /// <param name="playerID"></param>
        /// <param name="unitID"></param>
        /// <param name="param3"></param>
        /// <returns></returns>
        public ushort F0_2e31_0c1d(short playerID, short unitID, ushort param3)
        {
            this.oCPU.Log.EnterBlock($"F0_2e31_0c1d({playerID}, {unitID}, {param3})");

            // function body
            this.oCPU.PushWord(this.oCPU.BP.Word);
            this.oCPU.BP.Word = this.oCPU.SP.Word;
            this.oCPU.SP.Word = this.oCPU.SUBWord(this.oCPU.SP.Word, 0x4a);
            this.oCPU.PushWord(this.oCPU.DI.Word);
            this.oCPU.PushWord(this.oCPU.SI.Word);
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)playerID));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)unitID));
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d5));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x46), this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81d6));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4a), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, 0x8);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, 0x8);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6794, 0x0);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6796);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L0c89;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6798);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L0c89;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x46));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));
            this.oCPU.CX.Low = 0x4;
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, this.oCPU.CX.Low);
            this.oCPU.BX.Word = this.oCPU.ADDWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4a)));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.CMPByte(this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0xb780)), 0x0);
            if (this.oCPU.Flags.E) goto L0c89;
            goto L0d8b;

        L0c89:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590);
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6796, this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592);
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6798, this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x0ca0, size: 5
            this.oParent.MSCAPI.memset(0xb780, 0, 0x100);

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), 0x0);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), 0x0);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, 0x6590);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, 0x6594, this.oCPU.AX.Low);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2))));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, 0x6592);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6694), this.oCPU.AX.Low);
            this.oCPU.DI.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590);
            this.oCPU.DI.Word = this.oCPU.SUBWord(this.oCPU.DI.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));
            this.oCPU.CX.Low = 0x4;
            this.oCPU.DI.Word = this.oCPU.SHLWord(this.oCPU.DI.Word, this.oCPU.CX.Low);
            this.oCPU.DI.Word = this.oCPU.SUBWord(this.oCPU.DI.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592);
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.DI.Word + 0xb780), 0x1);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x14), 0x0);
            this.oCPU.AX.Word = param3;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6794, this.oCPU.AX.Word);
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)unitID));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)playerID));
            this.oCPU.DI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.DI.Word + 0x81d7)));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x1138)), 0x2);
            if (this.oCPU.Flags.NE) goto L0d0b;
            this.oCPU.AX.Word = 0x1;
            goto L0d0d;

        L0d0b:
            this.oCPU.AX.Word = 0;

        L0d0d:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x113a)), 0x1);
            if (this.oCPU.Flags.NE) goto L0d1c;
            this.oCPU.AX.Word = 0x1;
            goto L0d1e;

        L0d1c:
            this.oCPU.AX.Word = 0;

        L0d1e:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10), this.oCPU.AX.Word);

        L0d21:
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6594));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1c), this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6694));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4))));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4), this.oCPU.AX.Word);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1c));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));
            this.oCPU.CX.Low = 0x4;
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, this.oCPU.CX.Low);
            this.oCPU.BX.Word = this.oCPU.ADDWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0xb780));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6794);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.G) goto L0d7c;

            // Instruction address 0x2e31:0x0d63, size: 3
            F0_2e31_119b_AdjustXPosition(this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1c)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x46)));
            if (this.oCPU.Flags.NE) goto L0da8;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4a));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L0da8;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6794, this.oCPU.AX.Word);

        L0d7c:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0d8b;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4)), 0xe1);
            if (this.oCPU.Flags.L) goto L0d21;

            L0d8b:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16), 0xffff);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6794);
            this.oCPU.CMPWord(param3, this.oCPU.AX.Word);
            if (this.oCPU.Flags.G) goto L0d9b;
            goto L10ed;

        L0d9b:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa), 0x63);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c), 0x1);
            goto L0f29;

        L0da8:
            // Instruction address 0x2e31:0x0daf, size: 3
            F0_2e31_119b_AdjustXPosition(this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1c)));

            // Instruction address 0x2e31:0x0db6, size: 5
            this.oParent.Segment_2aea.F0_2aea_1570(
                (short)this.oCPU.AX.Word,
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8), this.oCPU.AX.Word);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c), 0x1);
            goto L0dea;

        L0dc8:
            this.oCPU.AX.Word = 0;

        L0dca:
            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1e)));
            if (this.oCPU.Flags.NE) goto L0dd2;
            goto L0e70;

        L0dd2:
            // Instruction address 0x2e31:0x0dd8, size: 5
            this.oParent.Segment_2aea.F0_2aea_1585(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.TESTByte(this.oCPU.AX.Low, 0x1);
            if (this.oCPU.Flags.E) goto L0de7;
            goto L0e70;

        L0de7:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c))));

        L0dea:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c)), 0x8);
            if (this.oCPU.Flags.G) goto L0d7c;
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c));
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1882));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1c)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590));

            // Instruction address 0x2e31:0x0e04, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x8);
            if (this.oCPU.Flags.GE) goto L0de7;

            // Instruction address 0x2e31:0x0e15, size: 3
            F0_2e31_119b_AdjustXPosition(this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc), this.oCPU.AX.Word);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c));
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x18e4));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x36)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592));

            // Instruction address 0x2e31:0x0e32, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x8);
            if (this.oCPU.Flags.GE) goto L0de7;

            // Instruction address 0x2e31:0x0e45, size: 5
            this.oParent.Segment_2aea.F0_2aea_1326_CheckMapBounds(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0de7;

            // Instruction address 0x2e31:0x0e57, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3e), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.E) goto L0e6a;
            goto L0dc8;

        L0e6a:
            this.oCPU.AX.Word = 0x1;
            goto L0dca;

        L0e70:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x8)), 0x0);
            if (this.oCPU.Flags.E) goto L0e8e;

            // Instruction address 0x2e31:0x0e7c, size: 5
            this.oParent.Segment_2aea.F0_2aea_1570(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0e8e;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe));
            this.oCPU.AX.Word = this.oCPU.INCWord(this.oCPU.AX.Word);
            goto L0ead;

        L0e8e:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x10)), 0x0);
            if (this.oCPU.Flags.E) goto L0e9c;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, 0x3);
            goto L0ead;

        L0e9c:
            this.oCPU.AX.Word = 0x13;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3e)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x3;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x28e)));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe)));

        L0ead:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a), this.oCPU.AX.Word);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));
            this.oCPU.CX.Low = 0x4;
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, this.oCPU.CX.Low);
            this.oCPU.BX.Word = this.oCPU.ADDWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0xb780));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x38), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L0ed7;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x38)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.G) goto L0ed7;
            goto L0de7;

        L0ed7:
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));
            this.oCPU.CX.Low = 0x4;
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, this.oCPU.CX.Low);
            this.oCPU.BX.Word = this.oCPU.ADDWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a));
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0xb780), this.oCPU.AX.Low);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40));
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6594), this.oCPU.AX.Low);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44));
            this.oCPU.WriteUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x6694), this.oCPU.AX.Low);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2))));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x2), this.oCPU.AX.Word);
            goto L0de7;

        L0f0d:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40), this.oCPU.ADDWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40)), 0x50));

        L0f11:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40));
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590));

            // Instruction address 0x2e31:0x0f19, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x8);
            if (this.oCPU.Flags.L) goto L0f61;

            L0f26:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c), this.oCPU.INCWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c))));

        L0f29:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c)), 0x8);
            if (this.oCPU.Flags.LE) goto L0f32;
            goto L10e2;

        L0f32:
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c));
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1882));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x46)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590));

            // Instruction address 0x2e31:0x0f46, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x48);
            if (this.oCPU.Flags.L) goto L0f11;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6590);
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.LE) goto L0f0d;
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40), this.oCPU.SUBWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40)), 0x50));
            goto L0f11;

        L0f61:
            // Instruction address 0x2e31:0x0f65, size: 3
            F0_2e31_119b_AdjustXPosition(this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc), this.oCPU.AX.Word);
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c));
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x18e4));
            this.oCPU.AX.Word = this.oCPU.ADDWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x4a)));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.SUBWord(this.oCPU.AX.Word, this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6592));

            // Instruction address 0x2e31:0x0f82, size: 5
            this.oParent.MSCAPI.abs((short)this.oCPU.AX.Word);

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0x8);
            if (this.oCPU.Flags.GE) goto L0f26;

            // Instruction address 0x2e31:0x0f95, size: 5
            this.oParent.Segment_2aea.F0_2aea_134a(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xa);
            if (this.oCPU.Flags.NE) goto L0fa7;
            this.oCPU.AX.Word = 0x1;
            goto L0fa9;

        L0fa7:
            this.oCPU.AX.Word = 0;

        L0fa9:
            this.oCPU.CX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)unitID));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)playerID));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Low = 0x22;
            this.oCPU.IMULByte(this.oCPU.AX, this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + this.oCPU.SI.Word + 0x81d7)));
            this.oCPU.BX.Word = this.oCPU.AX.Word;
            this.oCPU.SI.Word = this.oCPU.CX.Word;
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0x1138)), 0x2);
            if (this.oCPU.Flags.NE) goto L0fd1;
            this.oCPU.AX.Word = 0x1;
            goto L0fd3;

        L0fd1:
            this.oCPU.AX.Word = 0;

        L0fd3:
            this.oCPU.CMPWord(this.oCPU.AX.Word, this.oCPU.SI.Word);
            if (this.oCPU.Flags.E) goto L0fec;

            // Instruction address 0x2e31:0x0fdd, size: 5
            this.oParent.Segment_2aea.F0_2aea_1585(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.TESTByte(this.oCPU.AX.Low, 0x1);
            if (this.oCPU.Flags.NE) goto L0fec;
            goto L0f26;

        L0fec:
            this.oCPU.BX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x40));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x20)));
            this.oCPU.CX.Low = 0x4;
            this.oCPU.BX.Word = this.oCPU.SHLWord(this.oCPU.BX.Word, this.oCPU.CX.Low);
            this.oCPU.BX.Word = this.oCPU.ADDWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));
            this.oCPU.BX.Word = this.oCPU.SUBWord(this.oCPU.BX.Word, this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3a)));
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.BX.Word + 0xb780));
            this.oCPU.CBW(this.oCPU.AX);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ORWord(this.oCPU.AX.Word, this.oCPU.AX.Word);
            if (this.oCPU.Flags.NE) goto L100b;
            goto L0f26;

        L100b:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.GE) goto L106e;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16), this.oCPU.AX.Word);

            // Instruction address 0x2e31:0x1025, size: 5
            this.oParent.Segment_2aea.F0_2aea_1458(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xffff);
            if (this.oCPU.Flags.E) goto L1050;

            // Instruction address 0x2e31:0x103f, size: 5
            this.oParent.Segment_1866.F0_1866_1251(playerID,
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)), 2);

            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), this.oCPU.AX.Word);
            goto L1055;

        L1050:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), 0x0);

        L1055:
            // Instruction address 0x2e31:0x1063, size: 5
            this.oParent.Segment_2dc4.F0_2dc4_0289(
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6590),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6592),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), this.oCPU.ADDWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe)), this.oCPU.AX.Word));

        L106e:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xa));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x6)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.E) goto L1079;
            goto L0f26;

        L1079:
            // Instruction address 0x2e31:0x107f, size: 5
            this.oParent.Segment_2aea.F0_2aea_1458(
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12), this.oCPU.AX.Word);
            this.oCPU.CMPWord(this.oCPU.AX.Word, 0xffff);
            if (this.oCPU.Flags.E) goto L10aa;

            // Instruction address 0x2e31:0x1099, size: 5
            this.oParent.Segment_1866.F0_1866_1251(playerID,
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x12)), 2);

            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.AX.Word = this.oCPU.SHLWord(this.oCPU.AX.Word, 0x1);
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a), this.oCPU.AX.Word);
            goto L10af;

        L10aa:
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a), 0x0);

        L10af:
            // Instruction address 0x2e31:0x10bd, size: 5
            this.oParent.Segment_2dc4.F0_2dc4_0289(
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6590),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xc)),
                this.oCPU.ReadInt16(this.oCPU.DS.Word, 0x6592),
                this.oCPU.ReadInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x44)));

            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a), this.oCPU.ADDWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a)), this.oCPU.AX.Word));
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe));
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a)), this.oCPU.AX.Word);
            if (this.oCPU.Flags.L) goto L10d3;
            goto L0f26;

        L10d3:
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x3c));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16), this.oCPU.AX.Word);
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x1a));
            this.oCPU.WriteUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0xe), this.oCPU.AX.Word);
            goto L0f26;

        L10e2:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16)), 0xffff);
            if (this.oCPU.Flags.E) goto L10ed;
            this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16));
            goto L1116;

        L10ed:
            this.oCPU.CMPWord(this.oCPU.ReadUInt16(this.oCPU.SS.Word, (ushort)(this.oCPU.BP.Word - 0x16)), 0xffff);
            if (this.oCPU.Flags.NE) goto L1113;
            this.oCPU.AX.Word = 0x600;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)playerID));
            this.oCPU.SI.Word = this.oCPU.AX.Word;
            this.oCPU.AX.Word = 0xc;
            this.oCPU.IMULWord(this.oCPU.AX, this.oCPU.DX, (ushort)((short)unitID));
            this.oCPU.SI.Word = this.oCPU.ADDWord(this.oCPU.SI.Word, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81da));
            this.oCPU.AX.High = 0;
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, this.oCPU.AX.Word);
            this.oCPU.AX.Low = this.oCPU.ReadUInt8(this.oCPU.DS.Word, (ushort)(this.oCPU.SI.Word + 0x81db));
            this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, this.oCPU.AX.Word);

        L1113:
            this.oCPU.AX.Word = 0xffff;

        L1116:
            this.oCPU.SI.Word = this.oCPU.PopWord();
            this.oCPU.DI.Word = this.oCPU.PopWord();
            this.oCPU.SP.Word = this.oCPU.BP.Word;
            this.oCPU.BP.Word = this.oCPU.PopWord();
            // Far return
            this.oCPU.Log.ExitBlock("F0_2e31_0c1d");

            return this.oCPU.AX.Word;
        }

        /// <summary>
        /// ?
        /// </summary>
        /// <param name="xPos"></param>
        /// <param name="yPos"></param>
        /// <param name="xPos1"></param>
        /// <param name="yPos1"></param>
        /// <param name="flag"></param>
        /// <param name="param6"></param>
        /// <returns></returns>
        public ushort F0_2e31_111c(int xPos, int yPos, int xPos1, int yPos1, ushort flag, ushort param6)
        {
            this.oCPU.Log.EnterBlock($"F0_2e31_111c({xPos}, {yPos}, {xPos1}, {yPos1}, {flag}, {param6})");

            // function body
            if (Math.Abs(xPos - xPos1) <= 7 && Math.Abs(yPos - yPos1) <= 7)
            {
                this.oCPU.WriteUInt8(this.oCPU.DS.Word, 0x87c9, (byte)((sbyte)xPos));
                this.oCPU.WriteUInt8(this.oCPU.DS.Word, 0x87ca, (byte)((sbyte)yPos));
                this.oCPU.WriteUInt8(this.oCPU.DS.Word, 0x87cb, (byte)((flag == 0) ? 1 : 0x10));
                this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6590, (ushort)((short)xPos1));
                this.oCPU.WriteUInt16(this.oCPU.DS.Word, 0x6592, (ushort)((short)yPos1));

                // Instruction address 0x2e31:0x117c, size: 3
                F0_2e31_0c1d(0, 127, param6);

                this.oCPU.WriteUInt8(this.oCPU.DS.Word, 0x87cb, 0xff);

                if (this.oCPU.AX.Word == 0xffff)
                {
                    this.oCPU.AX.Word = 0xffff;
                }
                else
                {
                    this.oCPU.AX.Word = this.oCPU.ReadUInt16(this.oCPU.DS.Word, 0x6794);
                }
            }
            else
            {
                this.oCPU.AX.Word = 0xffff;
            }

            // Far return
            this.oCPU.Log.ExitBlock("F0_2e31_111c");

            return this.oCPU.AX.Word;
        }

        /// <summary>
        /// Adjust X position
        /// </summary>
        /// <param name="xPos"></param>
        /// <returns></returns>
        public int F0_2e31_119b_AdjustXPosition(int xPos)
        {
            int iRetVal = xPos;

            // function body
            if (xPos < 0)
            {
                iRetVal = xPos + 80;
            }
            else if (xPos >= 80)
            {
                iRetVal = xPos - 80;
            }

            this.oCPU.AX.Word = (ushort)((short)iRetVal);

            return iRetVal;
        }
    }
}
